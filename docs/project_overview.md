# TaskForge – Comprehensive Project Documentation

> **Version:** July 2025  
> **Repo:** `a-longshadow/TaskForge_django_users`

---

## 1  Project Purpose

TaskForge is an internal tool that ingests meeting-derived *action items*, lets humans approve/reject/ edit them, and synchronises approved tasks to Monday.com.  
It replaces e-mail based approvals with a web dashboard, guarantees traceability, and automates board updates.


## 2  High-Level Architecture

```text
┌───────────────┐    ingest (POST)    ┌─────────────┐
│ n8n workflow  │ ───────────────────▶│  API /ingest│
└───────────────┘                    └─────────────┘
                                         │ creates
                                         ▼
                                    Django models
                                         │
                     public UI          admin UI          REST API
                   (HTMX + Tailwind) ◀───────────────▶  /api/tasks/*
                                         │ approve/ reject
                                         ▼
                                 Monday.com GraphQL API
```

* **Backend:** Django 4.2 + DRF
* **DB:** PostgreSQL (Railway Add-on)
* **Frontend:** Tailwind-styled HTML (admin & public)
* **Hosting:** Railway (Dockerless buildpacks)
* **CI/CD:** GitHub → Railway auto-deploy


## 3  Key Features

| Area | Details |
|------|---------|
| Ingestion | `POST /api/ingest/` consumes meeting payloads with `monday_tasks` array. Creates `Meeting` & `Task` rows idempotently. |
| Review Workflow | Public page (`/tasks/`) groups pending tasks by meeting; users approve/decline with custom modal dialogs. |
| Admin Enhancements | • Approve/Reject buttons in list & detail views  • Bulk confirm pages  • Action logging (`ReviewAction`)  |
| Monday.com Sync | `tasks/services.create_monday_item()` maps Django fields → Monday columns, posts GraphQL mutation, stores `monday_item_id`. |
| Settings at Runtime | `AppSetting` model exposes Monday credentials & mappings via admin – no redeploy needed. |
| Security | Optional 5-second "preview" window; CSRF disabled for public endpoints but protected by obscurity link; autogenerated links expire after 24 h (configurable). |
| Auditing | `PageLog` middleware records every request; `ReviewAction` captures all approvals/rejections with user & reason. |


## 4  Data & Workflow Details

1. **Ingestion** (n8n) ➜ `IngestView`  
   • Parses tasks, creates PENDING rows.  
2. **Public Review**  
   • Anyone with the link visits `/tasks/`.  
   • Approve ➜ Ajax POST `/api/tasks/{id}/approve/?confirm=true`  
   • Reject (≥5 word reason) ➜ `/reject/`.  
3. **Admin Review**  
   • Enhanced Django admin supports single & bulk actions with confirmation pages.  
4. **Sync**  
   • On approval the backend calls Monday.com, stores item ID, marks `posted_to_monday=True`.  
5. **Logging**  
   • PageLog (every request) & ReviewAction (every decision) for audit.


## 5  Deployment (Railway)

1. **Environment variables**  
   * `DATABASE_URL` – provisioned by Railway  
   * `SECRET_KEY`  
   * `MONDAY_API_KEY` – *sk-proj-…* token  
   * `MONDAY_BOARD_ID` – string ID  
   * `MONDAY_GROUP_ID` – e.g. `group_mkqyryrz`  
   * `MONDAY_COLUMN_MAP` – JSON mapping columns (see sample below).
2. **Auto-deploy** – enabled on pushes to `main`.  
3. **Start CMD** – `gunicorn taskforge.wsgi --bind 0.0.0.0:$PORT` (Procfile handled by buildpack).  
4. **Static files** – Whitenoise served inside container.

### Sample column map
```json
{"team_member":"text_mkr7jgkp","email":"text_mkr0hqsb","priority":"status_1","status":"status","due_date":"date5","brief_description":"long_text"}
```


## 6  Local Development

```bash
# prerequisites: Python 3.12, Poetry/venv, PostgreSQL (or SQLite fallback)
cp .env.example .env              # add MONDAY credentials if you plan to test sync
python -m venv .venv && source .venv/bin/activate
pip install -r requirements.txt
python manage.py migrate
python manage.py createsuperuser
python manage.py seedgroups       # adds admin/user groups
python manage.py seedactionitems --dir ACTION_ITEMS --apply-settings
python manage.py runserver
```


## 7  Management Commands

| Command | Purpose |
|---------|---------|
| `seedgroups` | create default Django groups |
| `seedactionitems [--file FILE|--dir DIR] [--apply-settings]` | bulk-import ACTION_ITEMS json & optionally create Monday AppSettings |
| `test_monday` | one-off Monday.com API smoke-test |


## 8  REST API Cheat-Sheet

| Method & Path | Description |
|---------------|-------------|
| `GET /api/tasks/?status=pending` | list tasks |
| `POST /api/tasks/{id}/approve/?confirm=true` | approve & sync |
| `POST /api/tasks/{id}/reject/?confirm=true` + body `{reason}` | reject |
| `PATCH /api/tasks/{id}/edit/` | lightweight edit |
| `GET /api/meetings/{id}/` | meeting meta |

DRF browsable API is enabled in `DEBUG`.


## 9  Troubleshooting

| Symptom | Likely Cause | Fix |
|---------|-------------|-----|
| 500 in admin bulk action with `ACTION_CHECKBOX_NAME` | Old code deployed | Redeploy latest `main` |
| Approval returns 200 but nothing on Monday | Missing env/AppSetting, or column map wrong | Verify `MONDAY_*` vars; check logs for _Monday API errors_ |
| Tasks not visible on `/tasks/` | View filtered on `reviewed_at` in old code | Ensure container is on commit ≥ `2c2831c` |
| Duplicate meetings | ingest called twice with same `meeting_id` without clean DB | Truncate tables or rely on `get_or_create` |

Logs to consult: Railway *Logs* tab (`stdout`), Page Logs admin, Monday.com mutation history.


## 10  Security Notes

* **Public UI** link is obscured & expires after 24 h (can be changed per-task via `expires_after_h`).
* Sensitive env vars are never stored in Git – use Railway secrets.
* DRF auth disabled only for public endpoints; admin requires standard Django auth.


## 11  Future Roadmap

1. Two-way Monday sync (status → Django)
2. Real-time WebSocket updates on the public page
3. Dark-mode toggle, drag-and-drop prioritisation
4. Fine-grained role-based permissions for reviewers
5. Integration tests covering Monday failure modes

---

**Maintainers:**  
Levi Rybalov — levi@coophive.network  
Joe Maina — joe@coophive.network  

> Generated automatically by ChatGPT pair-programming session, July 2025 